<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Jarvis Chatbot</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet">
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    font-family: 'Segoe UI', sans-serif;
    background: linear-gradient(135deg, #0b1628, #081019);
    color: #e8f9f9;
    display: flex; flex-direction: column; align-items: center;
    justify-content: center; height: 100vh; padding: 1rem;
  }
  h2 {
    font-family: 'Orbitron', sans-serif;
    font-size: 1.8rem;
    color: #00f5d4;
    text-shadow: 0 0 8px #00f5d4cc, 0 0 16px #00f5d4aa;
    margin-bottom: 1rem;
    text-align: center;
  }
  #chat-container {
    width: 100%; max-width: 650px; height: 80vh;
    display: flex; flex-direction: column;
    background: rgba(15, 25, 35, 0.9);
    border-radius: 12px;
    overflow: hidden;
    border: 1px solid #00f5d444;
    box-shadow: 0 0 12px #00f5d433, 0 0 28px #00f5d422 inset;
  }
  #chat {
    flex: 1; padding: 1rem; overflow-y: auto;
    scroll-behavior: smooth;
  }
  #chat::-webkit-scrollbar { width: 8px; }
  #chat::-webkit-scrollbar-thumb {
    background: #00f5d4aa; border-radius: 4px;
  }
  #typing-indicator {
    display: none; font-style: italic;
    color: #80ffdb; margin-bottom: 0.5rem;
  }
  .msg {
    max-width: 85%; padding: 0.8rem 1rem; margin: 0.5rem 0;
    border-radius: 10px; position: relative;
    animation: fadeIn 0.35s ease;
    word-break: break-word;
  }
  .user-msg {
    background: #2a9d8f; align-self: flex-end; color: #fff;
    border-top-right-radius: 0;
  }
  .bot-msg {
    background: #264653; align-self: flex-start; color: #fff;
    border-top-left-radius: 0;
  }
  .error-msg { background: #e76f51; align-self: center; }
  .copy-btn {
    position: absolute; top: 6px; right: 6px;
    background: #00f5d4; color: #003c3a;
    border: none; font-size: 0.7rem; padding: 3px 6px;
    border-radius: 4px; cursor: pointer;
    opacity: 0.85; transition: 0.2s;
  }
  .copy-btn:hover { opacity: 1; }
  pre {
    background: rgba(0, 245, 212, 0.08);
    padding: 0.7rem; border-radius: 6px;
    overflow-x: auto; margin-top: 0.5rem;
  }
  code { white-space: pre; font-family: 'Consolas', monospace; }
  #input-container {
    display: flex; padding: 0.7rem; background: #0d1b2a;
    border-top: 1px solid #00f5d422;
  }
  #input {
    flex: 1; padding: 0.7rem 1rem;
    border-radius: 8px 0 0 8px; border: none; outline: none;
    font-size: 1rem; background: #1d3557; color: #fff;
  }
  #sendBtn {
    padding: 0 1.5rem; border: none;
    border-radius: 0 8px 8px 0;
    background: #00f5d4; color: #003c3a;
    font-weight: bold; cursor: pointer;
  }
  #sendBtn:hover { background: #80ffdb; }
  @keyframes fadeIn { from { opacity: 0; transform: translateY(5px);} to { opacity: 1; } }
  @media (max-width: 480px) {
    h2 { font-size: 1.4rem; }
    #chat-container { height: 75vh; }
    #input { font-size: 0.9rem; }
    #sendBtn { font-size: 0.9rem; }
  }
</style>
</head>
<body>

<h2>Jarvis AI Assistant</h2>

<div id="chat-container">
  <div id="chat">
    <div id="typing-indicator">Jarvis is typing...</div>
  </div>
  <div id="input-container">
    <input type="text" id="input" placeholder="Ask Jarvis..." autocomplete="off" />
    <button id="sendBtn">Send</button>
  </div>
</div>

<script>
const chat = document.getElementById('chat');
const typingIndicator = document.getElementById('typing-indicator');
const input = document.getElementById('input');
const sendBtn = document.getElementById('sendBtn');

const webhookUrl = "https://n8n-ifzdsbou.us-west-1.clawcloudrun.com/webhook/chatwebhook"; // Replace with your webhook
const sessionId = "user123";

// Show/hide typing indicator
function showTyping(show) {
  typingIndicator.style.display = show ? 'block' : 'none';
  if (show) chat.scrollTop = chat.scrollHeight;
}

// Append message (with optional typewriter effect for bot)
function appendMessage(content, className, typewriter = false) {
  const msg = document.createElement('div');
  msg.className = 'msg ' + className;

  // Add Copy button for bot
  if (className === 'bot-msg') {
    const copyBtn = document.createElement('button');
    copyBtn.textContent = 'Copy';
    copyBtn.className = 'copy-btn';
    copyBtn.onclick = () => {
      navigator.clipboard.writeText(content.replace(/^``````$/g, '').trim())
        .then(() => { copyBtn.textContent = 'Copied!'; setTimeout(() => copyBtn.textContent = 'Copy', 1500); });
    };
    msg.appendChild(copyBtn);
  }

  // For typewriter animation
  if (typewriter && className === 'bot-msg') {
    let textNode = document.createElement('div');
    msg.appendChild(textNode);
    chat.appendChild(msg);
    chat.scrollTop = chat.scrollHeight;

    let i = 0;
    function typing() {
      textNode.textContent = content.substring(0, i);
      i++;
      chat.scrollTop = chat.scrollHeight;
      if (i <= content.length) {
        setTimeout(typing, 20); // speed
      }
    }
    typing();
  } else {
    msg.textContent = content;
    chat.appendChild(msg);
  }

  chat.scrollTop = chat.scrollHeight;
}

// Send message
async function sendMessage() {
  const message = input.value.trim();
  if (!message) return;

  appendMessage("You: " + message, 'user-msg');
  input.value = '';
  input.disabled = true; sendBtn.disabled = true;
  showTyping(true);

  try {
    const res = await fetch(webhookUrl, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ sessionId, query: message })
    });
    if (!res.ok) throw new Error('Network error');
    const data = await res.json();
    showTyping(false);
    appendMessage(data.answer || "Sorry, no answer was returned.", 'bot-msg', true); // typewriter
  } catch (err) {
    showTyping(false);
    appendMessage("System Error: Please try again later.", 'error-msg');
  } finally {
    input.disabled = false; sendBtn.disabled = false; input.focus();
  }
}

sendBtn.addEventListener('click', sendMessage);
input.addEventListener('keydown', e => { if (e.key === 'Enter') sendMessage(); });
</script>

</body>
</html>
